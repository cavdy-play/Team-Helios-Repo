{"version":3,"sources":["../../Finance_api/routes/users.js"],"names":["express","require","router","Router","User","passport","validateRegisterInput","validateLoginInput","post","req","res","body","errors","isValid","name","undefined","flash","email","password","password2","redirect","findOne","check","create","next","authenticate","err","user","info","logIn","get","scope","failureRedirect","successRedirect","module","exports"],"mappings":"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","sourcesContent":["const express = require(\"express\");\r\nconst router = express.Router();\r\nconst User = require('../models/users');\r\nconst passport = require('../config/passport');\r\n\r\n// Load input validation\r\nconst validateRegisterInput = require(\"../validation/register\");\r\nconst validateLoginInput = require(\"../validation/login\");\r\n// Load User model\r\n\r\nrouter.post(\"/register\", async (req, res) => {\r\n  // Form validation\r\n  const { errors, isValid } = validateRegisterInput(req.body);\r\n  // Check validation\r\n  if (!isValid) {\r\n    if (errors.name !== undefined) req.flash('success_msg', errors.name);\r\n    if (errors.email !== undefined) req.flash('success_msg', errors.email);\r\n    if (errors.password !== undefined) req.flash('success_msg', errors.password);\r\n    if (errors.password2 !== undefined) req.flash('success_msg', errors.password2);\r\n    return res.redirect('back');\r\n  }\r\n\r\n  const check = await User.findOne({ email: req.body.email });\r\n  if (check) {\r\n    req.flash('success_msg', 'Email already in use');\r\n    return res.redirect('back');\r\n  }\r\n\r\n  await User.create(req.body);\r\n  req.flash('success_msg', 'Account created successfully, you can now login');\r\n  return res.redirect('/');\r\n});\r\n\r\nrouter.post(\"/login\", async (req, res, next) => {\r\n  passport.authenticate('local', function (err, user, info) {\r\n    if (err) return next(err)\r\n    if (!user) {\r\n      req.flash('success_msg', 'Incorect Email or password');\r\n      return res.redirect('back');\r\n    }\r\n    req.logIn(user, function (err) {\r\n      if (err) return next(err);\r\n      return res.redirect('/home');\r\n    });\r\n  })(req, res, next);\r\n});\r\n\r\n// Facebook Login auth\r\nrouter.get('/auth/google', passport.authenticate('google', { scope: ['profile','email'] }));\r\nrouter.get('/auth/google/callback', passport.authenticate('google', {\r\n    failureRedirect: '/',\r\n    successRedirect: '/home'\r\n}));\r\n\r\nmodule.exports = router;\r\n"],"file":"users.js"}