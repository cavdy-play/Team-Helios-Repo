{"version":3,"sources":["../../Finance_api/routes/index.js"],"names":["router","express","Router","Date","prototype","getWeek","dt","getFullYear","Math","ceil","getDay","use","req","res","next","locals","success_msg","flash","error_msg","error","user","Expenses","find","id","populate","sort","createdAt","userExpenses","aggregate","$match","mongoose","Types","ObjectId","$group","_id","amount","$sum","tota","year","toString","week","month","getMonth","checkLoggedIn","isAuthenticated","redirect","get","render","auth","logout","module","exports"],"mappings":"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","sourcesContent":["import express from 'express';\nimport auth from '../config/auth';\nimport flash from 'express-flash';\nimport mongoose from 'mongoose';\nimport Expenses from '../models/expenses';\nconst router = express.Router();\n\nDate.prototype.getWeek = function() {\n  var dt = new Date(this.getFullYear(), 0, 1);\n  return Math.ceil(((this - dt) / 86400000 + dt.getDay() + 1) / 7);\n};\n\nrouter.use(async (req, res, next) => {\n  res.locals.success_msg = req.flash('success_msg');\n  res.locals.error_msg = req.flash('error_msg');\n  res.locals.error = req.flash('error');\n  res.locals.user = req.user || null;\n  res.locals.userExpenses =\n    typeof req.user == 'undefined'\n      ? null\n      : await Expenses.find({ user: req.user.id })\n          .populate('user')\n          .sort({ createdAt: -1 });\n  res.locals.tota =\n    typeof req.user == 'undefined'\n      ? null\n      : await Expenses.aggregate([\n          {\n            $match: {\n              user: mongoose.Types.ObjectId(req.user.id)\n            }\n          },\n          {\n            $group: {\n              _id: null,\n              amount: {\n                $sum: '$amount'\n              }\n            }\n          }\n        ]);\n  res.locals.year =\n    typeof req.user == 'undefined'\n      ? null\n      : await Expenses.aggregate([\n          {\n            $match: {\n              user: mongoose.Types.ObjectId(req.user.id),\n              year: new Date().getFullYear().toString()\n            }\n          },\n          {\n            $group: {\n              _id: null,\n              amount: {\n                $sum: '$amount'\n              }\n            }\n          }\n        ]);\n  res.locals.week =\n    typeof req.user == 'undefined'\n      ? null\n      : await Expenses.aggregate([\n          {\n            $match: {\n              user: mongoose.Types.ObjectId(req.user.id),\n              week: new Date().getWeek().toString()\n            }\n          },\n          {\n            $group: {\n              _id: null,\n              amount: {\n                $sum: '$amount'\n              }\n            }\n          }\n        ]);\n  res.locals.month =\n    typeof req.user == 'undefined'\n      ? null\n      : await Expenses.aggregate([\n          {\n            $match: {\n              user: mongoose.Types.ObjectId(req.user.id),\n              month: new Date().getMonth().toString()\n            }\n          },\n          {\n            $group: {\n              _id: null,\n              amount: {\n                $sum: '$amount'\n              }\n            }\n          }\n        ]);\n  next();\n});\n\nfunction checkLoggedIn(req, res, next) {\n  if (req.isAuthenticated()) res.redirect('back');\n  else {\n    next();\n  }\n}\n\n// Get index page\nrouter.get('/', (req, res, next) => {\n  if (req.isAuthenticated()) {\n    res.redirect('/home');\n  } else {\n    res.render('index');\n  }\n});\n\nrouter.get('/signup', checkLoggedIn, (req, res, next) => {\n  res.render('sign-up');\n});\n\nrouter.get('/faq', (req, res, next) => {\n  res.render('faq');\n});\n\nrouter.get('/home', auth, (req, res, next) => {\n  //res.send(res.locals.tota)\n  res.render('home');\n});\n\nrouter.get('/about', (req, res, next) => {\n  res.render('about');\n});\n\nrouter.get('/contact', (req, res, next) => {\n  res.render('contact');\n});\n\nrouter.get('/log-out', (req, res, next) => {\n  req.logout();\n  return res.redirect('/');\n});\n\nmodule.exports = router;\n"],"file":"index.js"}