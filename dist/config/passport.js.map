{"version":3,"sources":["../../Finance_api/config/passport.js"],"names":["LocalStrategy","require","Strategy","GoogleStrategy","passport","serializeUser","user","done","id","deserializeUser","User","findById","err","use","usernameField","passwordField","email","password","findOne","message","comparePassword","isMatch","clientID","clientSecret","callbackURL","accessToken","refreshToken","profile","process","nextTick","emails","value","console","log","payload","name","displayName","split","join","toLowerCase","profilePicture","photos","active","provider","googleId","newUser","save","module","exports"],"mappings":"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","sourcesContent":["import passport from 'passport';\r\nconst LocalStrategy = require('passport-local').Strategy;\r\nconst GoogleStrategy = require('passport-google-oauth20'). Strategy;\r\nimport User from '../models/users';\r\n\r\n//Serialize user\r\npassport.serializeUser((user, done) => {\r\n  done(null, user.id)\r\n})\r\n\r\n//Deserialize user\r\npassport.deserializeUser((id, done) => { User.findById(id, (err, user) => { done(err, user) }) });\r\n\r\n//Local Strategy\r\npassport.use(new LocalStrategy({\r\n  usernameField: 'email',\r\n  passwordField: 'password',\r\n}, (email, password, done) => {\r\n  User.findOne({ email: email }, (err, user) => {\r\n      if (err) return done(err);\r\n      if (!user) return done(null, false, { message: 'Incorrect Username' });\r\n      user.comparePassword(password, (err, isMatch) => {\r\n          if (isMatch) {\r\n              return done(null, user);\r\n          } else {\r\n              return done(null, false, { message: 'Incorrect password.' });\r\n          }\r\n      })\r\n  })\r\n}))\r\n\r\npassport.use(new GoogleStrategy({\r\n    clientID: \"1039166944193-st34fsrpgqd02eocno2ouog9teutr1rf.apps.googleusercontent.com\",\r\n    clientSecret: \"V0ElXoVRVA5-5ktT8MaiZe5y\",\r\n    callbackURL: \"/auth/google/callback\",\r\n  }, function (accessToken, refreshToken, profile, done) {\r\n    process.nextTick(() => {\r\n        User.findOne({ email: profile.emails[0].value }, (err, user) => {\r\n            if (err)\r\n                return done(err);\r\n            if (user)\r\n                return done(null, user);\r\n            else {\r\n                console.log(profile)\r\n                let payload = {\r\n                    email: profile.emails[0].value,\r\n                    name: profile.displayName.split(\" \").join('-').toLowerCase(),\r\n                    profilePicture: profile.photos[0].value,\r\n                    active: true,\r\n                    provider:profile.provider,\r\n                    googleId: profile.id\r\n                };\r\n                let newUser = new User(payload);\r\n                newUser.save((err, user) => {\r\n                    if (err)\r\n                        throw err;\r\n                    return done(null, newUser);\r\n                })\r\n            }\r\n        });\r\n    });\r\n  }\r\n  ));\r\n\r\nmodule.exports = passport;"],"file":"passport.js"}